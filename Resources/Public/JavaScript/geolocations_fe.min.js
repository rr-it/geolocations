/*! EXT:geolocations */
var TYPO3=TYPO3||{};var google=google||{};var Gl=Gl||{};Gl={ajaxRequestUrl:"index.php?eID=geolocations",elMessageField:"#geolocations-message",firstRun:false,addressFieldChangedManually:false,latLng:null,elSearchContainer:"#geolocations-search",elFieldAddress:"#search-address",elFieldRadius:"#search-radius",elFieldKeyword:"#search-keyword",elFieldsetRadial:"#search-radial",elFieldsetFulltext:"#search-fulltext",elButtonRadial:"#search-radial-button",elButtonFulltext:"#search-fulltext-button",elButtonSearchType:"#search-type",elClearFieldName:".search-clear",sO:null,elMapContainer:"#geolocations-map",elMapCanvas:"#map-canvas",elMapToggleLock:"#toggle-lock",elMapLoadingOverlay:"#loading-overlay",mO:null,map:null,markers:null,positionMarker:null,perimeterCircle:null,elListContainer:"#geolocations-list",locationElementsName:".geolocations-list-item",locationInfoName:".geolocation-list-info",locationBodyName:".location-body",lO:null,initialize:function(){if(Gl.initializeGlobalElements()){Gl.initializeListOptions();Gl.initializeList();Gl.initializeMapOptions();Gl.initializeMap();Gl.initializeSearchOptions();Gl.initializeSearch();Gl.mapToggleLoadingOverlay(false);Gl.listSetLocationMarkers()}},initializeGlobalElements:function(){Gl.elMessageField=$(Gl.elMessageField).length&&$(Gl.elMessageField)||null;Gl.elListContainer=$(Gl.elListContainer).length&&$(Gl.elListContainer)||null;Gl.elMapContainer=$(Gl.elMapContainer).length&&$(Gl.elMapContainer)||null;Gl.elMapCanvas=$(Gl.elMapCanvas).length&&$(Gl.elMapCanvas)||null;Gl.elMapToggleLock=$(Gl.elMapToggleLock).length&&$(Gl.elMapToggleLock)||null;Gl.elMapLoadingOverlay=$(Gl.elMapLoadingOverlay).length&&$(Gl.elMapLoadingOverlay)||null;Gl.elSearchContainer=$(Gl.elSearchContainer).length&&$(Gl.elSearchContainer)||null;Gl.elFieldAddress=$(Gl.elFieldAddress).length&&$(Gl.elFieldAddress)||null;Gl.elFieldRadius=$(Gl.elFieldRadius).length&&$(Gl.elFieldRadius)||null;Gl.elFieldKeyword=$(Gl.elFieldKeyword).length&&$(Gl.elFieldKeyword)||null;Gl.elButtonSearchType=$(Gl.elButtonSearchType).length&&$(Gl.elButtonSearchType)||null;Gl.elFieldsetRadial=$(Gl.elFieldsetRadial).length&&$(Gl.elFieldsetRadial)||null;Gl.elButtonRadial=$(Gl.elButtonRadial).length&&$(Gl.elButtonRadial)||null;Gl.elFieldsetFulltext=$(Gl.elFieldsetFulltext).length&&$(Gl.elFieldsetFulltext)||null;Gl.elButtonFulltext=$(Gl.elButtonFulltext).length&&$(Gl.elButtonFulltext)||null;if(!Gl.elMapContainer&&!Gl.elSearchContainer&&!Gl.elListContainer){return false}else{return true}},initializeListOptions:function(){Gl.lO={clickMode:Gl.elListContainer.data("clickmode")}},initializeList:function(){if(Gl.lO.clickMode){switch(Gl.lO.clickMode){case"unveilRecord":$(Gl.locationElementsName).click(Gl.listUnveilRecord);break;case"showInMap":$(Gl.locationElementsName).click(Gl.listShowInMap);break}}},initializeMapOptions:function(){if(Gl.elMapContainer){Gl.mO={};var p={};var r=[];var f=[];var q=Gl.elMapContainer.data("center");var a=Gl.elMapContainer.data("zoom");var h=Gl.elMapContainer.data("minzoom");var j=Gl.elMapContainer.data("maxzoom");var s=Gl.elMapContainer.data("zoomcontrol");var c=Gl.elMapContainer.data("draggable");var g=Gl.elMapContainer.data("scrollwheel");var n=Gl.elMapContainer.data("enabledragscroll");var o=Gl.elMapContainer.data("fullscreencontrol");var d=Gl.elMapContainer.data("background");var l=Gl.elMapContainer.data("circle");var k=Gl.elMapContainer.data("maptypes");var b=Gl.elMapContainer.data("userstyles");if(q){q=q.split(",");p.center=Gl.getLatLng(q[0],q[1])}else{p.center=Gl.getLatLng(48.2081743,16.3738189)}if(a){p.zoom=parseInt(a)}else{p.zoom=14}if(h){p.minZoom=parseInt(h)}if(j){p.maxZoom=parseInt(j)}if(s){p.zoomControl=Gl.parseBoolean(s)}Gl.mO.draggable=Gl.parseBoolean(c);p.draggable=false;Gl.mO.scrollwheel=Gl.parseBoolean(g);p.scrollwheel=false;Gl.mO.enableDragScroll=Gl.parseBoolean(n);if(Gl.mO.enableDragScroll){if(Gl.mO.draggable){p.draggable=true}if(Gl.mO.scrollwheel){p.scrollwheel=true}}if(o){p.fullscreenControl=Gl.parseBoolean(o)}if(d){p.backgroundColor=d}if(l){Gl.mO.circleColor=l}if(k&&k!==""){f=k.split(",")}if(b&&b!==""){try{var m=1;b=$.parseJSON($.parseJSON(b));$.each(b,function(i,t){f.push("user_style"+m);r.push({mapTypeId:"user_style"+m,name:i,config:t});m++})}catch(e){console.warn("Style could not be preprocessed.")}}if(f.length>0){p.mapTypeControlOptions={mapTypeIds:f}}if(r.length>0){Gl.mO.styledMapTypes=r}p.scaleControl=true;p.streetViewControl=false;p.scaleControlOptions={position:google.maps.ControlPosition.BOTTOM_LEFT};Gl.mO.defaults=p}},initializeMap:function(){if(Gl.mO&&Gl.elMapContainer&&Gl.elMapCanvas&&Gl.mO.defaults){if(!Gl.map){Gl.map=new google.maps.Map(Gl.elMapCanvas[0],Gl.mO.defaults)}if(Gl.mO.styledMapTypes){$.each(Gl.mO.styledMapTypes,function(b,d){var c=null;try{c=new google.maps.StyledMapType(d.config,{name:d.name})}catch(e){console.warn("Style could not be applied.")}if(c){Gl.map.mapTypes.set(d.mapTypeId,c);Gl.map.setMapTypeId(d.mapTypeId)}})}if(Gl.elFieldRadius){var a=Gl.elFieldRadius.val()}if(Gl.mO.draggable||Gl.mO.scrollwheel){google.maps.event.addListenerOnce(this,"tilesloaded",Gl.mapCustomControls())}}},initializeSearchOptions:function(){if(Gl.elSearchContainer){var a=Gl.elSearchContainer.data("search");var c=Gl.elSearchContainer.data("autocompleter");var f=Gl.elSearchContainer.data("autocompleter-country");var d=Gl.elSearchContainer.data("autocompleter-types");var g=Gl.elSearchContainer.data("autocompleter-language");var e=Gl.elSearchContainer.data("autoposition");var b=Gl.elSearchContainer.data("perimeter");Gl.sO={autocompleter:{enabled:Gl.parseBoolean(c)},autoposition:Gl.parseBoolean(e)};if(f&&f!==""){Gl.sO.autocompleter.country=f}if(d&&d!==""){Gl.sO.autocompleter.types=d}if(g&&g!==""){Gl.sO.autocompleter.language=g}if(b){Gl.sO.perimeter=Gl.parseBoolean(b)}Gl.sO.searchObject=a}},initializeSearch:function(){if(Gl.sO&&Gl.sO.searchObject.length&&Gl.elSearchContainer){if(Gl.elFieldAddress){if(Gl.sO.autocompleter&&Gl.sO.autocompleter.enabled){Gl.searchSetAutocompleter()}if(Gl.sO.autoposition){Gl.searchSetGeolocation()}}if(Gl.elFieldRadius){Gl.elFieldRadius.change(Gl.searchRadiusChanged)}Gl.searchSetTypeToggle();Gl.searchSetButtonsAndElements()}},listSetLocationMarkers:function(){Gl.mapClearMarkers();Gl.markers=[];if($(Gl.locationInfoName).length>0){var a=new google.maps.LatLngBounds();var b=new google.maps.InfoWindow({content:"",maxWidth:203});$(Gl.locationInfoName).each(function(){var d=$(this);var f=Gl.getLatLng(d.data("latitude"),d.data("longitude"));a.extend(f);var c=new google.maps.Marker({map:Gl.map,position:f,bounds:true,title:d.data("title"),content:d.html(),zIndex:d.data("index"),id:"mk_"+d.data("uid"),letter:d.data("uid")});var e=d.data("icon");if(e&&e!==""){c.setIcon(e)}Gl.markers.push(c);google.maps.event.addListener(c,"click",function(){b.close();b.setContent(this.content);b.open(Gl.map,this)})});Gl.map.fitBounds(a)}},listUnveilRecord:function(){$(this).find(Gl.locationBodyName).fadeToggle()},listShowInMap:function(){var a=Gl.getLatLng($(this).data("latitude"),$(this).data("longitude"));Gl.map.panTo(a);Gl.map.setZoom(15);google.maps.event.trigger(Gl.markers[$(this).data("index")],"click");$("html, body").animate({scrollTop:Gl.elMapCanvas.position().top+60},200)},searchSetAutocompleter:function(){var a={};if(Gl.sO.autocompleter.types){a.types=[Gl.sO.autocompleter.types]}if(Gl.sO.autocompleter.country){a.componentRestrictions={country:Gl.sO.autocompleter.country}}var b=new google.maps.places.Autocomplete(Gl.elFieldAddress[0],a);b.addListener("place_changed",function(){Gl.addressFieldChangedManually=false;var c=b.getPlace();if(!c.geometry){var d=$(".pac-container .pac-item:first").text();Gl.reverseGeocode({address:d},"formatted_address",Gl.reverseGeocodeReturned)}else{Gl.latLng=c.geometry.location;Gl.mapUpdate(Gl.latLng);Gl.searchStartRadial()}})},searchSetGeolocation:function(){if(!!navigator.geolocation){navigator.geolocation.getCurrentPosition(function(a){var b=Gl.getLatLng(a.coords.latitude,a.coords.longitude);Gl.reverseGeocode({location:b},"formatted_address",Gl.reverseGeocodeReturned);Gl.msg("autocomplete.success","Position could be automatically resolved.",2)},function(){Gl.msg("autocomplete.error","Geolocation service failed.",4)})}else{Gl.msg("autocomplete.notavailable","Position could not be resolved.",5)}},searchSetTypeToggle:function(){if(Gl.elButtonRadial){Gl.elButtonRadial.prop("disabled",true)}if(Gl.elButtonFulltext){Gl.elButtonFulltext.prop("disabled",true)}if(Gl.elButtonSearchType){var a=null;$('#search-type input[type="radio"]:checked').each(function(){a=$(this).val()});$("#search-"+a).show();Gl.elButtonSearchType.change(function(){Gl.elFieldsetFulltext.toggle();Gl.elFieldsetRadial.toggle()})}else{if(Gl.elFieldsetFulltext){Gl.elFieldsetFulltext.show()}if(Gl.elFieldsetRadial){Gl.elFieldsetRadial.show()}}},searchSetButtonsAndElements:function(){if(Gl.elFieldsetRadial){if(Gl.elFieldKeyword){Gl.elFieldAddress.on("input",function(){Gl.addressFieldChangedManually=true;if($(this).val().length<3){Gl.elButtonRadial.prop("disabled",true)}else{Gl.elButtonRadial.prop("disabled",false)}})}if(Gl.elButtonRadial){Gl.elButtonRadial.on("click",function(){Gl.reverseGeocode({address:Gl.elFieldAddress.val()},"formatted_address",Gl.reverseGeocodeReturned)})}}if(Gl.elFieldsetFulltext){if(Gl.elFieldKeyword){Gl.elFieldKeyword.on("input",function(){if($(this).val().length<3){Gl.elButtonFulltext.prop("disabled",true)}else{Gl.elButtonFulltext.prop("disabled",false)}});Gl.elFieldKeyword.focusin(function(){$(this).keypress(function(a){if(!Gl.elButtonFulltext.prop("disabled")){if(a.which===13){Gl.searchStartFulltext()}}})})}if(Gl.elButtonFulltext){Gl.elButtonFulltext.on("click",Gl.searchStartFulltext)}}$(Gl.elClearFieldName).on("click",Gl.searchClearField)},searchClearField:function(){$(this).siblings("input").val("").focus();$(this).parent().parent().find("button").attr("disabled",true)},searchRadiusChanged:function(){if(Gl.sO.perimeter){if(Gl.perimeterCircle){Gl.perimeterCircle.setRadius(parseInt(Gl.elFieldRadius.val())*1000);if(Gl.addressFieldChangedManually){Gl.reverseGeocode({address:Gl.elFieldAddress.val()},"formatted_address",Gl.reverseGeocodeReturned)}else{Gl.searchStartRadial()}}}},searchCheckInput:function(){if($(this).val().length<3){Gl.elButtonFulltext.prop("disabled",true)}else{Gl.elButtonFulltext.prop("disabled",false)}},searchToggleFieldset:function(b,a){if(b.length){if(a){b.find("select, input, button").attr("disabled",false)}else{b.find("select, input, button").attr("disabled",true)}}},searchStartRadial:function(){if(Gl.latLng){var a={searchType:"radial",latitude:Gl.latLng.lat(),longitude:Gl.latLng.lng(),radius:Gl.elFieldRadius.val()};Gl.searchAjax(Gl.searchGetRequest(a),Gl.searchAjaxReturned,Gl.elFieldsetRadial)}},searchStartFulltext:function(){if(Gl.positionMarker){Gl.positionMarker.setMap(null);Gl.positionMarker=false}if(Gl.perimeterCircle){Gl.perimeterCircle.setMap(null);Gl.perimeterCircle=false}var a=Gl.elFieldKeyword.val();if(a!==""){var b={searchType:"fulltext",keyword:a};Gl.searchAjax(Gl.searchGetRequest(b),Gl.searchAjaxReturned,Gl.elFieldsetFulltext)}},searchGetRequest:function(b){var a={tx_geolocations_pi1:{controller:"Ajax",action:"search",searchObject:Gl.sO.searchObject,categories:Gl.getCheckedCategories()}};$.extend(a.tx_geolocations_pi1,b);return a},searchAjax:function(b,c,a){Gl.mapToggleLoadingOverlay(true);Gl.searchToggleFieldset(a,false);$.ajax({url:Gl.getBaseUrl()+Gl.ajaxRequestUrl,data:b,type:"get",dataType:"json",cache:false,async:true,success:function(d){c(d,a)},error:function(d,f,e){console.error(e);c(null,a)}})},searchAjaxReturned:function(b,a){if(b){Gl.elListContainer.html(b);Gl.initializeList();Gl.listSetLocationMarkers()}Gl.mapToggleLoadingOverlay(false);Gl.searchToggleFieldset(a,true)},getCheckedCategories:function(){var a=[];$("#search-categories input[type='checkbox']:checked").each(function(){a.push($(this).val())});return a},mapCustomControls:function(){var a=document.createElement("div");var b=Gl.elMapToggleLock.detach();if(!Gl.mO.enableDragScroll){b.addClass("disabled")}b.show();b[0].addEventListener("click",function(){Gl.mapToggleCustomControls()});a.appendChild(b[0]);Gl.map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(a)},mapToggleCustomControls:function(a){if(a===true){if(Gl.mO.draggable){Gl.map.set("draggable",true)}if(Gl.mO.scrollwheel){Gl.map.set("scrollwheel",true)}Gl.elMapToggleLock.removeClass("disabled")}else{if(a===false){Gl.map.set("draggable",false);Gl.map.set("scrollwheel",false);Gl.elMapToggleLock.addClass("disabled")}else{if(Gl.mO.draggable){Gl.mapToggleOptions("draggable")}if(Gl.mO.scrollwheel){Gl.mapToggleOptions("scrollwheel")}Gl.elMapToggleLock.toggleClass("disabled")}}},mapToggleOptions:function(a){if(Gl.map.get(a)){Gl.map.set(a,false)}else{Gl.map.set(a,true)}},mapToggleLoadingOverlay:function(a){if(Gl.elMapLoadingOverlay){if(a){Gl.elMapLoadingOverlay.fadeIn(50)}else{Gl.elMapLoadingOverlay.fadeOut(300)}}},mapUpdate:function(a){Gl.latLng=a;if(Gl.map){if(Gl.elMapCanvas){if(Gl.sO.perimeter&&Gl.elFieldRadius){if(!Gl.perimeterCircle){Gl.perimeterCircle=new google.maps.Circle({strokeColor:Gl.mO.circleColor,strokeOpacity:0.8,strokeWeight:2,fillColor:"#ffffff",fillOpacity:0.05,map:Gl.map,center:a,radius:Gl.elFieldRadius.val()*1000,cursor:null})}Gl.perimeterCircle.setCenter(a);if(!Gl.firstRun){Gl.map.fitBounds(Gl.perimeterCircle.getBounds())}}if(!Gl.positionMarker){Gl.positionMarker=new google.maps.Marker({position:a,icon:{path:google.maps.SymbolPath.CIRCLE,strokeColor:Gl.mO.circleColor,fillColor:"#ffffff",fillOpacity:0.9,strokeWeight:3,scale:8},draggable:true,map:Gl.map});google.maps.event.addListener(Gl.positionMarker,"dragend",function(){var c=Gl.getLatLng(this.getPosition().lat(),this.getPosition().lng());Gl.latLng=c;var b=Gl.reverseGeocode({location:c},"formatted_address",Gl.reverseGeocodeReturned);if(Gl.elMapCanvas){if(Gl.sO.perimeter){Gl.perimeterCircle.setCenter(c)}Gl.map.panTo(c)}})}if(!Gl.firstRun){Gl.positionMarker.setPosition(a);Gl.map.setCenter(a)}}Gl.firstRun=false}},mapClearMarkers:function(){if(Gl.markers&&Gl.markers.length>0){for(var a=0;a<Gl.markers.length;a++){Gl.markers[a].setMap(null)}Gl.markers.length=0}},reverseGeocode:function(a,d,c){var b=new google.maps.Geocoder();if(b){b.geocode(a,function(f,e){if(e===google.maps.GeocoderStatus.OK){if(f[0]){var g="";switch(d){case"formatted_address":g=f[0].formatted_address;break;case"place_id":g=f[0].place_id;break;default:break}c(g,f)}}else{c()}})}},reverseGeocodeReturned:function(b,a){if(a){Gl.latLng=a[0].geometry.location;Gl.mapUpdate(Gl.latLng);Gl.searchStartRadial()}else{Gl.msg("autocomplete.notavailable","Position could not be resolved.",5)}if(Gl.elFieldAddress){Gl.elFieldAddress.val(b)}Gl.elButtonRadial.prop("disabled",false)},getLatLng:function(b,a){if(!b||b===""){b=0}if(!a||a===""){a=0}return new google.maps.LatLng(parseFloat(b),parseFloat(a))},getBaseUrl:function(){var a=$("base");if(a.length>0&&a!=="/"){a=jQuery("base").prop("href");if(a.substr(0,2)==="//"){a=window.location.protocol+a}}else{if(window.location.protocol!=="https:"){a="http://"+window.location.hostname+"/"}else{a="https://"+window.location.hostname+"/"}}return a},parseBoolean:function(a){if(a===1||a==="1"||a==="true"){return true}else{return false}},msg:function(d,c,b){if(d!==""&&TYPO3.lang[d][0]["target"]){c=TYPO3.lang[d][0]["target"]}if(Gl.elMessageField){var a="";switch(b){case 5:console.error(c);a="danger";break;case 4:console.warn(c);a="warning";break;case 3:console.info(c);a="info";break;case 2:console.log(c);a="success";break;case 1:console.debug(c);a="primary";break;case 0:default:console.log(c);a="default";break}Gl.elMessageField.removeClass();Gl.elMessageField.addClass("message-"+a);Gl.elMessageField.text(c).show();Gl.elMessageField.delay(1000).fadeOut(400)}}};jQuery(window).load(function(a){if(typeof google==="object"&&typeof google.maps==="object"){Gl.initialize()}});
												